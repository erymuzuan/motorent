@inherits MotoRentComponentBase
@using MotoRent.Domain.Entities

<div class="modal-body">
    <div class="row g-4">
        @* Image *@
        <div class="col-12 col-md-6">
            <div class="rounded overflow-hidden bg-light">
                <img src="@GetMotorbikeImage()" alt="@GetMotorbikeAlt()"
                     class="w-100" style="height: 300px; object-fit: cover;" />
            </div>
        </div>

        @* Details *@
        <div class="col-12 col-md-6">
            <div class="d-flex flex-column gap-3">
                <div>
                    <h3 class="mb-1">@Motorbike.Brand @Motorbike.Model</h3>
                    <p class="text-secondary mb-0">@Motorbike.Year - @Motorbike.EngineCC cc</p>
                </div>

                <span class="badge bg-success">
                    <i class="ti ti-check me-1"></i>
                    Available for Rent
                </span>

                <hr class="my-0" />

                <div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Daily Rate</span>
                        <span class="h4 text-primary mb-0">@FormatCurrency(Motorbike.DailyRate)</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Security Deposit</span>
                        <span>@FormatCurrency(Motorbike.DepositAmount)</span>
                    </div>
                </div>

                @if (DateRange != null)
                {
                    var days = (DateRange.End!.Value - DateRange.Start!.Value).Days + 1;
                    var total = Motorbike.DailyRate * days;

                    <div class="card bg-primary-lt">
                        <div class="card-body py-3">
                            <small class="text-primary d-block mb-1">
                                @FormatDate(DateRange.Start.Value) - @FormatDate(DateRange.End.Value) (@days days)
                            </small>
                            <div class="d-flex justify-content-between align-items-center">
                                <strong>Estimated Total</strong>
                                <span class="h4 text-primary mb-0">@FormatCurrency(total)</span>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        @* Specifications *@
        <div class="col-12">
            <h4 class="mb-3">Specifications</h4>
            <div class="row g-3">
                <div class="col-6 col-sm-3">
                    <div class="card bg-light">
                        <div class="card-body py-3 text-center">
                            <i class="ti ti-engine text-primary fs-2 mb-2"></i>
                            <small class="text-secondary d-block">Engine</small>
                            <strong>@Motorbike.EngineCC cc</strong>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-sm-3">
                    <div class="card bg-light">
                        <div class="card-body py-3 text-center">
                            <i class="ti ti-calendar text-primary fs-2 mb-2"></i>
                            <small class="text-secondary d-block">Year</small>
                            <strong>@Motorbike.Year</strong>
                        </div>
                    </div>
                </div>
                @if (!string.IsNullOrEmpty(Motorbike.Color))
                {
                    <div class="col-6 col-sm-3">
                        <div class="card bg-light">
                            <div class="card-body py-3 text-center">
                                <i class="ti ti-palette text-primary fs-2 mb-2"></i>
                                <small class="text-secondary d-block">Color</small>
                                <strong>@Motorbike.Color</strong>
                            </div>
                        </div>
                    </div>
                }
                <div class="col-6 col-sm-3">
                    <div class="card bg-light">
                        <div class="card-body py-3 text-center">
                            <i class="ti ti-gas-station text-primary fs-2 mb-2"></i>
                            <small class="text-secondary d-block">Fuel Type</small>
                            <strong>Petrol</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* What's Included *@
        <div class="col-12">
            <h4 class="mb-3">What's Included</h4>
            <div class="d-flex flex-wrap gap-2">
                <span class="badge bg-success-lt">
                    <i class="ti ti-check me-1"></i> 2 Helmets
                </span>
                <span class="badge bg-success-lt">
                    <i class="ti ti-check me-1"></i> Rain Gear
                </span>
                <span class="badge bg-success-lt">
                    <i class="ti ti-check me-1"></i> Phone Holder
                </span>
                <span class="badge bg-success-lt">
                    <i class="ti ti-check me-1"></i> 24/7 Support
                </span>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Motorbike.Notes))
        {
            <div class="col-12">
                <div class="alert alert-info">
                    <i class="ti ti-info-circle me-2"></i>
                    @Motorbike.Notes
                </div>
            </div>
        }
    </div>
</div>

<div class="modal-footer">
    <button type="button" class="btn btn-ghost-secondary" @onclick="Cancel">Close</button>
    <button type="button" class="btn btn-primary" @onclick="Reserve">
        Reserve This Bike
        <i class="ti ti-arrow-right ms-1"></i>
    </button>
</div>

@code {
    [CascadingParameter] private ModalInstance? ModalInstance { get; set; }
    [Parameter] public Motorbike Motorbike { get; set; } = new();
    [Parameter] public DateRangeSelection? DateRange { get; set; }

    private void Cancel() => this.ModalInstance?.Cancel();

    private void Reserve() => this.ModalInstance?.Close(true);

    private string GetMotorbikeImage()
    {
        if (!string.IsNullOrEmpty(this.Motorbike.ImagePath))
            return this.Motorbike.ImagePath;

        return "images/motorbike-placeholder.jpg";
    }

    private string GetMotorbikeAlt() => $"{this.Motorbike.Brand} {this.Motorbike.Model}";

    public class DateRangeSelection
    {
        public DateTime? Start { get; set; }
        public DateTime? End { get; set; }

        public DateRangeSelection() { }
        public DateRangeSelection(DateTime? start, DateTime? end)
        {
            this.Start = start;
            this.End = end;
        }
    }
}
