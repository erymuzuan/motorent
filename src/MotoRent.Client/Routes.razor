<CascadingAuthenticationState>
    <Router AppAssembly="typeof(Program).Assembly">
        <Found Context="routeData">
            <AuthorizeRouteView RouteData="routeData" DefaultLayout="@GetLayoutType(routeData)">
                <NotAuthorized>
                    @if (context.User.Identity?.IsAuthenticated != true)
                    {
                        <RedirectToLogin />
                    }
                    else
                    {
                        <p class="text-danger">You are not authorized to access this resource.</p>
                    }
                </NotAuthorized>
            </AuthorizeRouteView>
            <FocusOnNavigate RouteData="routeData" Selector="h1" />
        </Found>
    </Router>
</CascadingAuthenticationState>

@code {
    private Type GetLayoutType(RouteData routeData)
    {
        var pageNamespace = routeData.PageType.Namespace ?? string.Empty;
        var pageName = routeData.PageType.FullName ?? string.Empty;

        // Staff pages use StaffLayout
        if (pageNamespace.Contains(".Pages.Staff") || pageName.Contains(".Pages.Staff"))
        {
            return typeof(Layout.StaffLayout);
        }

        // Tourist pages use TouristLayout
        if (pageNamespace.Contains(".Pages.Tourist") || pageName.Contains(".Pages.Tourist"))
        {
            return typeof(Layout.TouristLayout);
        }

        // Manager pages use ManagerLayout
        if (pageNamespace.Contains(".Pages.Manager") || pageName.Contains(".Pages.Manager"))
        {
            return typeof(Layout.ManagerLayout);
        }

        // Default to MainLayout
        return typeof(Layout.MainLayout);
    }
}
