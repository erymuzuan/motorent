@* Dashboard KPI metric card *@

<div class="@($"card metric-card {Class}")" style="@GetStyle()">
    <div class="card-body">
        @* Header with icon *@
        <div class="d-flex justify-content-between align-items-start">
            <span class="text-secondary small">@Title</span>
            @if (!string.IsNullOrEmpty(Icon))
            {
                <i class="@($"ti {Icon}")" style="font-size: 1.25rem; color: @IconColorValue;"></i>
            }
        </div>

        @* Main Value *@
        <h4 class="mt-2 mb-1 fw-semibold">
            @if (!string.IsNullOrEmpty(Prefix))
            {
                <span style="font-size: 0.7em;">@Prefix</span>
            }
            @Value
            @if (!string.IsNullOrEmpty(Suffix))
            {
                <span class="text-secondary" style="font-size: 0.6em;">@Suffix</span>
            }
        </h4>

        @* Trend Indicator *@
        @if (ShowTrend && TrendPercent != 0)
        {
            <div class="d-flex align-items-center gap-1">
                <i class="@GetTrendIcon() @GetTrendColorClass()" style="font-size: 0.875rem;"></i>
                <span class="@GetTrendColorClass() small">@Math.Abs(TrendPercent).ToString("N1")%</span>
                <span class="text-secondary small">vs @TrendPeriod</span>
            </div>
        }

        @* Optional subtitle *@
        @if (!string.IsNullOrEmpty(Subtitle))
        {
            <small class="text-secondary">@Subtitle</small>
        }
    </div>
</div>

<style>
    .metric-card {
        border-radius: 12px;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1) !important;
    }

    .metric-card.clickable {
        cursor: pointer;
    }
</style>

@code {
    [Parameter] public string Title { get; set; } = "Metric";
    [Parameter] public string Value { get; set; } = "0";
    [Parameter] public string? Prefix { get; set; }
    [Parameter] public string? Suffix { get; set; }
    [Parameter] public string? Subtitle { get; set; }
    [Parameter] public string? Icon { get; set; }
    [Parameter] public string IconColor { get; set; } = "primary";
    [Parameter] public string? Class { get; set; }
    [Parameter] public string? BackgroundColor { get; set; }

    // Trend
    [Parameter] public bool ShowTrend { get; set; }
    [Parameter] public double TrendPercent { get; set; }
    [Parameter] public string TrendPeriod { get; set; } = "last week";
    [Parameter] public bool TrendPositiveIsGood { get; set; } = true;

    private string IconColorValue => this.IconColor switch
    {
        "primary" => "var(--tblr-primary)",
        "secondary" => "var(--tblr-secondary)",
        "success" => "var(--tblr-success)",
        "danger" => "var(--tblr-danger)",
        "warning" => "var(--tblr-warning)",
        "info" => "var(--tblr-info)",
        _ => $"var(--tblr-{this.IconColor})"
    };

    private string GetStyle()
    {
        if (!string.IsNullOrEmpty(this.BackgroundColor))
            return $"background: {this.BackgroundColor};";
        return "";
    }

    private string GetTrendIcon()
    {
        return this.TrendPercent > 0
            ? "ti ti-trending-up"
            : "ti ti-trending-down";
    }

    private string GetTrendColorClass()
    {
        var isPositive = this.TrendPercent > 0;
        var isGood = this.TrendPositiveIsGood ? isPositive : !isPositive;
        return isGood ? "text-success" : "text-danger";
    }
}
