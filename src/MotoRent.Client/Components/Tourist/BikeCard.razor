@* Enhanced motorbike card with larger image and status overlay *@
@using MotoRent.Domain.Entities

<div class="card bike-card @Class" @onclick="OnCardClick">
    @* Image Container with Overlay *@
    <div class="bike-card-image-container position-relative">
        <img src="@GetImageUrl()" alt="@($"{Motorbike.Brand} {Motorbike.Model}")"
             class="bike-card-image w-100" style="@(Compact ? "aspect-ratio: 4/3;" : "aspect-ratio: 16/10;") object-fit: cover;" />

        @* Status Badge Overlay *@
        <div class="position-absolute" style="top: 12px; left: 12px;">
            <span class="badge @GetStatusBadgeClass() text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.5px;">
                @GetStatusText()
            </span>
        </div>

        @* Favorite Button *@
        @if (ShowFavorite)
        {
            <button type="button" class="btn btn-icon position-absolute favorite-button"
                    style="top: 8px; right: 8px; background: rgba(255, 255, 255, 0.9);"
                    @onclick="OnFavoriteClick" @onclick:stopPropagation="true">
                @if (IsFavorite)
                {
                    <i class="ti ti-heart-filled text-danger"></i>
                }
                else
                {
                    <i class="ti ti-heart"></i>
                }
            </button>
        }

        @* Compare Checkbox *@
        @if (ShowCompare)
        {
            <div class="position-absolute" style="bottom: 8px; right: 8px; background: rgba(255, 255, 255, 0.9); border-radius: 4px; padding: 2px;">
                <input type="checkbox" class="form-check-input" checked="@IsSelected"
                       @onchange="OnSelectChanged" @onclick:stopPropagation="true" />
            </div>
        }
    </div>

    <div class="card-body p-3">
        @* Title Row *@
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <div class="fw-bold" style="line-height: 1.3;">
                    @Motorbike.Brand @Motorbike.Model
                </div>
                <small class="text-secondary">
                    @Motorbike.EngineCC cc • Automatic • @Motorbike.Year
                </small>
            </div>
        </div>

        @* Rating (if available) *@
        @if (Rating > 0)
        {
            <div class="d-flex align-items-center gap-1 mt-1">
                @for (int i = 1; i <= 5; i++)
                {
                    <i class="ti ti-star@(i <= Math.Round(Rating) ? "-filled text-yellow" : " text-muted")" style="font-size: 0.875rem;"></i>
                }
                <small class="text-secondary">(@ReviewCount)</small>
            </div>
        }

        @* Price *@
        <div class="d-flex align-items-baseline gap-1 mt-2">
            <small class="text-secondary">From</small>
            <span class="h4 text-primary mb-0 fw-bold">฿@Motorbike.DailyRate.ToString("N0")</span>
            <small class="text-secondary">/day</small>
        </div>

        @* Features Tags *@
        @if (ShowFeatures)
        {
            <div class="d-flex flex-wrap gap-1 mt-2">
                @if (!string.IsNullOrEmpty(Motorbike.Color))
                {
                    <span class="badge badge-outline">@Motorbike.Color</span>
                }
                @if (Motorbike.EngineCC >= 150)
                {
                    <span class="badge bg-info-lt">Sport</span>
                }
            </div>
        }
    </div>

    @* Action Buttons *@
    @if (ShowActions)
    {
        <div class="card-footer px-3 pb-3 pt-0 bg-transparent border-0">
            @if (Compact)
            {
                <button type="button" class="btn btn-primary w-100 btn-sm"
                        @onclick="OnReserveClick" @onclick:stopPropagation="true">
                    Reserve
                </button>
            }
            else
            {
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-ghost-primary btn-sm"
                            @onclick="OnDetailsClick" @onclick:stopPropagation="true">
                        Details
                    </button>
                    <button type="button" class="btn btn-primary btn-sm"
                            @onclick="OnReserveClick" @onclick:stopPropagation="true">
                        Reserve
                        <i class="ti ti-arrow-right ms-1"></i>
                    </button>
                </div>
            }
        </div>
    }
</div>

<style>
    .bike-card {
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .bike-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12) !important;
    }

    .bike-card-image-container {
        overflow: hidden;
        background: var(--tblr-bg-surface-secondary);
    }

    .bike-card-image {
        transition: transform 0.3s ease;
    }

    .bike-card:hover .bike-card-image {
        transform: scale(1.05);
    }

    .favorite-button:hover {
        background: white !important;
    }
</style>

@code {
    [Parameter, EditorRequired] public Motorbike Motorbike { get; set; } = default!;
    [Parameter] public string? Class { get; set; }
    [Parameter] public bool Compact { get; set; }
    [Parameter] public bool ShowActions { get; set; } = true;
    [Parameter] public bool ShowFavorite { get; set; } = true;
    [Parameter] public bool ShowCompare { get; set; }
    [Parameter] public bool ShowFeatures { get; set; } = true;
    [Parameter] public bool IsFavorite { get; set; }
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public double Rating { get; set; }
    [Parameter] public int ReviewCount { get; set; }

    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public EventCallback OnDetailsClick { get; set; }
    [Parameter] public EventCallback OnReserveClick { get; set; }
    [Parameter] public EventCallback<bool> OnFavoriteChanged { get; set; }
    [Parameter] public EventCallback<bool> OnSelectedChanged { get; set; }

    private string GetImageUrl()
    {
        if (!string.IsNullOrEmpty(this.Motorbike.ImagePath))
            return this.Motorbike.ImagePath;

        // Brand-specific placeholders
        return this.Motorbike.Brand?.ToLower() switch
        {
            "honda" => "https://placehold.co/400x250/00897B/white?text=Honda",
            "yamaha" => "https://placehold.co/400x250/1565C0/white?text=Yamaha",
            "suzuki" => "https://placehold.co/400x250/E65100/white?text=Suzuki",
            "kawasaki" => "https://placehold.co/400x250/2E7D32/white?text=Kawasaki",
            _ => "https://placehold.co/400x250/424242/white?text=Motorbike"
        };
    }

    private string GetStatusBadgeClass()
    {
        return this.Motorbike.Status switch
        {
            "Available" => "bg-success",
            "Rented" => "bg-warning",
            "Maintenance" => "bg-danger",
            "Reserved" => "bg-info",
            _ => "bg-secondary"
        };
    }

    private string GetStatusText()
    {
        return this.Motorbike.Status switch
        {
            "Available" => "Available",
            "Rented" => "Rented",
            "Maintenance" => "Unavailable",
            "Reserved" => "Reserved",
            _ => this.Motorbike.Status ?? "Unknown"
        };
    }

    private async Task OnCardClick()
    {
        if (this.OnClick.HasDelegate)
            await this.OnClick.InvokeAsync();
        else if (this.OnDetailsClick.HasDelegate)
            await this.OnDetailsClick.InvokeAsync();
    }

    private async Task OnFavoriteClick()
    {
        await this.OnFavoriteChanged.InvokeAsync(!this.IsFavorite);
    }

    private async Task OnSelectChanged(ChangeEventArgs e)
    {
        var value = (bool?)e.Value ?? false;
        await this.OnSelectedChanged.InvokeAsync(value);
    }
}
