@* Enhanced motorbike card with larger image and status overlay *@
@using MotoRent.Domain.Entities

<MudCard Elevation="@Elevation" Class="@($"bike-card {Class}")" @onclick="OnCardClick">
    @* Image Container with Overlay *@
    <div class="bike-card-image-container">
        <MudImage Src="@GetImageUrl()" Alt="@($"{Motorbike.Brand} {Motorbike.Model}")"
                  ObjectFit="ObjectFit.Cover" Class="bike-card-image" />

        @* Status Badge Overlay *@
        <div class="bike-card-status">
            <MudChip T="string" Size="Size.Small"
                     Color="@GetStatusColor()"
                     Variant="Variant.Filled"
                     Class="status-chip">
                @GetStatusText()
            </MudChip>
        </div>

        @* Favorite Button *@
        @if (ShowFavorite)
        {
            <MudIconButton Icon="@(IsFavorite ? Icons.Material.Filled.Favorite : Icons.Material.Outlined.FavoriteBorder)"
                           Color="@(IsFavorite ? Color.Error : Color.Default)"
                           Size="Size.Small"
                           Class="favorite-button"
                           OnClick="OnFavoriteClick"
                           OnClickStopPropagation="true" />
        }

        @* Compare Checkbox *@
        @if (ShowCompare)
        {
            <MudCheckBox T="bool" Value="@IsSelected" ValueChanged="OnSelectChanged"
                         Color="Color.Primary" Class="compare-checkbox"
                         StopClickPropagation="true" />
        }
    </div>

    <MudCardContent Class="pa-3">
        @* Title Row *@
        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Start">
            <MudStack Spacing="0">
                <MudText Typo="Typo.subtitle1" Style="font-weight: 600; line-height: 1.3;">
                    @Motorbike.Brand @Motorbike.Model
                </MudText>
                <MudText Typo="Typo.caption" Color="Color.Secondary">
                    @Motorbike.EngineCC cc • Automatic • @Motorbike.Year
                </MudText>
            </MudStack>
        </MudStack>

        @* Rating (if available) *@
        @if (Rating > 0)
        {
            <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center" Class="mt-1">
                <MudRating ReadOnly="true" SelectedValue="@((int)Math.Round(Rating))" Size="Size.Small" />
                <MudText Typo="Typo.caption" Color="Color.Secondary">(@ReviewCount)</MudText>
            </MudStack>
        }

        @* Price *@
        <MudStack Row="true" AlignItems="AlignItems.Baseline" Class="mt-2" Spacing="1">
            <MudText Typo="Typo.caption" Color="Color.Secondary">From</MudText>
            <MudText Typo="Typo.h6" Color="Color.Primary" Style="font-weight: 700;">
                ฿@Motorbike.DailyRate.ToString("N0")
            </MudText>
            <MudText Typo="Typo.caption" Color="Color.Secondary">/day</MudText>
        </MudStack>

        @* Features Tags *@
        @if (ShowFeatures)
        {
            <MudStack Row="true" Spacing="1" Class="mt-2" Style="flex-wrap: wrap; gap: 4px;">
                @if (!string.IsNullOrEmpty(Motorbike.Color))
                {
                    <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined" Color="Color.Default">
                        @Motorbike.Color
                    </MudChip>
                }
                @if (Motorbike.EngineCC >= 150)
                {
                    <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined" Color="Color.Info">
                        Sport
                    </MudChip>
                }
            </MudStack>
        }
    </MudCardContent>

    @* Action Buttons *@
    @if (ShowActions)
    {
        <MudCardActions Class="px-3 pb-3 pt-0">
            @if (Compact)
            {
                <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                           Size="Size.Small" OnClick="OnReserveClick" OnClickStopPropagation="true">
                    Reserve
                </MudButton>
            }
            else
            {
                <MudButton Variant="Variant.Text" Color="Color.Primary" Size="Size.Small"
                           OnClick="OnDetailsClick" OnClickStopPropagation="true">
                    Details
                </MudButton>
                <MudSpacer />
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small"
                           EndIcon="@Icons.Material.Filled.ArrowForward"
                           OnClick="OnReserveClick" OnClickStopPropagation="true">
                    Reserve
                </MudButton>
            }
        </MudCardActions>
    }
</MudCard>

<style>
    .bike-card {
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .bike-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12) !important;
    }

    .bike-card-image-container {
        position: relative;
        aspect-ratio: 16 / 10;
        overflow: hidden;
        background: var(--mud-palette-background-grey);
    }

    .bike-card-image {
        width: 100%;
        height: 100%;
        transition: transform 0.3s ease;
    }

    .bike-card:hover .bike-card-image {
        transform: scale(1.05);
    }

    .bike-card-status {
        position: absolute;
        top: 12px;
        left: 12px;
    }

    .status-chip {
        font-weight: 500;
        text-transform: uppercase;
        font-size: 0.7rem;
        letter-spacing: 0.5px;
    }

    .favorite-button {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(4px);
    }

    .favorite-button:hover {
        background: white;
    }

    .compare-checkbox {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(4px);
        border-radius: 4px;
        padding: 2px;
    }

    /* Compact mode */
    .bike-card.compact .bike-card-image-container {
        aspect-ratio: 4 / 3;
    }
</style>

@code {
    [Parameter, EditorRequired] public Motorbike Motorbike { get; set; } = default!;
    [Parameter] public int Elevation { get; set; } = 2;
    [Parameter] public string? Class { get; set; }
    [Parameter] public bool Compact { get; set; }
    [Parameter] public bool ShowActions { get; set; } = true;
    [Parameter] public bool ShowFavorite { get; set; } = true;
    [Parameter] public bool ShowCompare { get; set; }
    [Parameter] public bool ShowFeatures { get; set; } = true;
    [Parameter] public bool IsFavorite { get; set; }
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public double Rating { get; set; }
    [Parameter] public int ReviewCount { get; set; }

    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public EventCallback OnDetailsClick { get; set; }
    [Parameter] public EventCallback OnReserveClick { get; set; }
    [Parameter] public EventCallback<bool> OnFavoriteChanged { get; set; }
    [Parameter] public EventCallback<bool> OnSelectedChanged { get; set; }

    private string GetImageUrl()
    {
        if (!string.IsNullOrEmpty(Motorbike.ImagePath))
            return Motorbike.ImagePath;

        // Brand-specific placeholders
        return Motorbike.Brand?.ToLower() switch
        {
            "honda" => "https://placehold.co/400x250/00897B/white?text=Honda",
            "yamaha" => "https://placehold.co/400x250/1565C0/white?text=Yamaha",
            "suzuki" => "https://placehold.co/400x250/E65100/white?text=Suzuki",
            "kawasaki" => "https://placehold.co/400x250/2E7D32/white?text=Kawasaki",
            _ => "https://placehold.co/400x250/424242/white?text=Motorbike"
        };
    }

    private Color GetStatusColor()
    {
        return Motorbike.Status switch
        {
            "Available" => Color.Success,
            "Rented" => Color.Warning,
            "Maintenance" => Color.Error,
            "Reserved" => Color.Info,
            _ => Color.Default
        };
    }

    private string GetStatusText()
    {
        return Motorbike.Status switch
        {
            "Available" => "Available",
            "Rented" => "Rented",
            "Maintenance" => "Unavailable",
            "Reserved" => "Reserved",
            _ => Motorbike.Status ?? "Unknown"
        };
    }

    private async Task OnCardClick()
    {
        if (OnClick.HasDelegate)
            await OnClick.InvokeAsync();
        else if (OnDetailsClick.HasDelegate)
            await OnDetailsClick.InvokeAsync();
    }

    private async Task OnFavoriteClick()
    {
        await OnFavoriteChanged.InvokeAsync(!IsFavorite);
    }

    private async Task OnSelectChanged(bool value)
    {
        await OnSelectedChanged.InvokeAsync(value);
    }
}
