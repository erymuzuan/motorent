# การทดสอบ QA: เช็คอินการเช่าพร้อมราคาแบบไดนามิก

## รหัสทดสอบ: DP-004
## ฟีเจอร์: ราคาแบบไดนามิกในขั้นตอนการเช่า
## ความสำคัญ: สูงมาก

---

## เงื่อนไขเบื้องต้น
- เปิดใช้งานราคาแบบไดนามิกแล้ว (DP-001 ผ่าน)
- ร้านมีกฎราคาแล้ว (DP-002 ผ่าน)
- ผู้ใช้เข้าสู่ระบบในฐานะ Staff, ShopManager หรือ OrgAdmin
- มียานพาหนะว่างอย่างน้อยหนึ่งคัน
- มีผู้เช่าอย่างน้อยหนึ่งคน

## ขั้นตอนการทดสอบ

### ขั้นตอนที่ 1: เริ่มการเช่าใหม่
1. ไปที่ **การเช่า** > **เช่าใหม่** หรือคลิกปุ่ม **เช็คอิน**
2. เลือกยานพาหนะ
3. เลือกผู้เช่า
4. ดำเนินการไปยังขั้นตอนกำหนดวันที่/ราคา

**ผลที่คาดหวัง:** ขั้นตอนกำหนดค่าการเช่าโหลด

### ขั้นตอนที่ 2: เลือกวันที่ครอบคลุมหลายช่วงราคา
1. ตั้ง **วันเริ่มต้น** เป็นวันที่ในไฮซีซั่น (เช่น 25 ธันวาคม)
2. ตั้ง **วันสิ้นสุด** ให้ครอบคลุมไปยังช่วงราคาอื่น (เช่น 15 มกราคม)

**ผลที่คาดหวัง:**
- ราคารวมคำนวณอัตโนมัติ
- ถ้าราคาแบบไดนามิกใช้งาน ส่วนแยกรายละเอียดรายวันจะปรากฏ

### ขั้นตอนที่ 3: ตรวจสอบรายละเอียดราคารายวัน
1. สังเกตส่วนรายละเอียดราคา

**ผลที่คาดหวัง:** ส่วนแสดง:
- หัวข้อ: "รายละเอียดราคารายวัน" หรือคล้ายกัน
- ตารางพร้อมคอลัมน์: วันที่, ราคาพื้นฐาน, ตัวคูณ, รวมรายวัน
- แต่ละวันแสดงตัวคูณที่ใช้งาน (เช่น 2.5x สำหรับ 1-7 ม.ค.)
- วันที่มีตัวคูณต่างกันจัดกลุ่มหรือเน้น
- ยอดรวมตรงกับผลรวมของยอดรายวัน

### ขั้นตอนที่ 4: ตรวจสอบการแสดงกฎที่ใช้
1. ตรวจสอบข้อมูลกฎที่ใช้

**ผลที่คาดหวัง:**
- แสดงว่ากฎราคาใดถูกใช้
- ชื่อกฎแสดงให้เห็น (เช่น "ปีใหม่รัสเซีย", "ไฮซีซั่น")
- ค่าตัวคูณแสดง

### ขั้นตอนที่ 5: เปลี่ยนวันที่เป็นโลว์ซีซั่น
1. เปลี่ยนวันที่เป็นช่วงโลว์ซีซั่น (เช่น 15 มิถุนายน - 25 มิถุนายน)

**ผลที่คาดหวัง:**
- ราคาคำนวณใหม่ด้วยตัวคูณต่ำกว่า (เช่น 0.6x)
- รายละเอียดรายวันอัปเดต
- ราคารวมต่ำกว่าราคาพื้นฐาน × จำนวนวัน

### ขั้นตอนที่ 6: เสร็จสิ้นการเช็คอิน
1. ดำเนินการต่อผ่านขั้นตอนที่เหลือ
2. เสร็จสิ้นกระบวนการเช็คอิน

**ผลที่คาดหวัง:**
- การเช่าถูกสร้างสำเร็จ
- กฎราคาที่ใช้ถูกเก็บพร้อมกับการเช่า

---

## ข้อมูลทดสอบ

### สถานการณ์ทดสอบที่แนะนำ

#### สถานการณ์ A: ไฮซีซั่นเท่านั้น
- เริ่ม: 25 ธันวาคม 2568
- สิ้นสุด: 5 มกราคม 2569
- คาดหวัง: ตัวคูณสูง (1.6x - 2.8x)

#### สถานการณ์ B: โลว์ซีซั่นเท่านั้น
- เริ่ม: 15 มิถุนายน 2568
- สิ้นสุด: 25 มิถุนายน 2568
- คาดหวัง: ตัวคูณต่ำ (0.55x - 0.65x)

#### สถานการณ์ C: ผสมฤดูกาล
- เริ่ม: 25 ตุลาคม 2568
- สิ้นสุด: 10 พฤศจิกายน 2568
- คาดหวัง: ผสมช่วงเปลี่ยนผ่าน (1.1x) และไฮซีซั่น (1.6x)

#### สถานการณ์ D: ช่วงอีเวนต์
- เริ่ม: 12 เมษายน 2568
- สิ้นสุด: 18 เมษายน 2568
- คาดหวัง: ตัวคูณสงกรานต์ (1.8x)

### ตัวอย่างการคำนวณ
| วันที่ | ราคาพื้นฐาน | ตัวคูณ | รวมรายวัน |
|------|-----------|------------|-------------|
| 25 ธ.ค. | ฿500 | 2.2x | ฿1,100 |
| 26 ธ.ค. | ฿500 | 2.2x | ฿1,100 |
| 27 ธ.ค. | ฿500 | 2.2x | ฿1,100 |
| 1 ม.ค. | ฿500 | 2.8x | ฿1,400 |
| 2 ม.ค. | ฿500 | 2.8x | ฿1,400 |
| **รวม** | | | **฿6,100** |

## เกณฑ์ผ่าน
- [ ] รายละเอียดราคารายวันแสดงเมื่อราคาแบบไดนามิกใช้งาน
- [ ] แต่ละวันแสดงตัวคูณถูกต้องตามกฎที่ใช้งาน
- [ ] ยอดรายวันคำนวณถูกต้อง (พื้นฐาน × ตัวคูณ)
- [ ] ยอดรวมเท่ากับผลรวมของยอดรายวัน
- [ ] กฎที่ใช้แสดงพร้อมชื่อ
- [ ] ราคาอัปเดตเมื่อเปลี่ยนวันที่
- [ ] การเช่าเสร็จสมบูรณ์พร้อมเก็บข้อมูลราคา

## หมายเหตุ
- ถ้าไม่มีกฎราคาใช้กับวันที่ที่เลือก จะใช้อัตราแบนมาตรฐาน
- หลายกฎในวันเดียวกัน: กฎที่มีความสำคัญสูงสุดชนะ
- ราคาพื้นฐานมาจากการตั้งค่าอัตรารายวันของยานพาหนะ
