# ระบบแจ้งเตือนการบำรุงรักษาอัตโนมัติ - คู่มือการตรวจสอบด้วยตนเอง

คู่มือนี้ระบุขั้นตอนสำหรับ QA ในการตรวจสอบการใช้งานระบบแจ้งเตือนการบำรุงรักษาอัตโนมัติ (Automated Maintenance Alerts) ด้วยตนเอง

## สิ่งที่ต้องมีก่อนเริ่ม (Pre-requisites)
1. **การอัปเดตฐานข้อมูล:** ตรวจสอบให้แน่ใจว่าได้ใช้ SQL schema แล้ว: `database/012-maintenance-alerts-schema.sql`
2. **สภาพแวดล้อม:** เว็บแอปพลิเคชันและ Scheduler ต้องกำหนดค่าให้ชี้ไปยังฐานข้อมูลเดียวกัน
3. **การตั้งค่าข้อมูล:** ควรมีรถอย่างน้อยหนึ่งคันที่มี `MaintenanceSchedule` ที่มีสถานะ "Due Soon" (ใกล้ถึงกำหนด) หรือ "Overdue" (เกินกำหนด) (ตามวันที่หรือเลขไมล์)

---

## กรณีทดสอบที่ 1: การสร้างการแจ้งเตือนจากระบบหลังบ้าน (Scheduler)
**วัตถุประสงค์:** ตรวจสอบว่างานเบื้องหลังระบุการบำรุงรักษาที่ถึงกำหนดได้อย่างถูกต้องและสร้างการแจ้งเตือน

1. **รัน Scheduler Runner:**
   เปิด terminal และรัน:
   ```powershell
   dotnet run --project src\MotoRent.Scheduler\MotoRent.Scheduler.csproj -- /r:MaintenanceAlertRunner
   ```
2. **ตรวจสอบผลลัพธ์:**
   - ยืนยันว่าผลลัพธ์ในคอนโซลแสดง: `Starting automated maintenance alert generation...`
   - ยืนยันว่าผลลัพธ์สุดท้ายแสดง: `Alert generation completed. X new alerts created.` (โดยที่ X > 0 หากมีรายการที่ถึงกำหนด)

---

## กรณีทดสอบที่ 2: การมองเห็นวิดเจ็ตบนแดชบอร์ด
**วัตถุประสงค์:** ตรวจสอบว่าพนักงานสามารถมองเห็นการแจ้งเตือนการบำรุงรักษาบนแดชบอร์ดหน้าหลัก

1. **เข้าสู่ระบบ:** เข้าสู่ระบบด้วยสิทธิ์ Staff, Shop Manager หรือ Org Admin
2. **ดูแดชบอร์ด:** ไปที่หน้าหลัก (`/`)
3. **ตรวจสอบวิดเจ็ต:**
   - ยืนยันว่ามีวิดเจ็ต "Maintenance Alerts" อยู่ในส่วนเนื้อหาหลัก
   - หากมีการแจ้งเตือนอยู่ ให้ยืนยันว่ารายการแสดงป้ายทะเบียนรถและประเภทบริการที่ถูกต้อง
   - ยืนยันว่ามีปุ่ม "View All"

---

## กรณีทดสอบที่ 3: หน้าการแจ้งเตือนและการนำทาง
**วัตถุประสงค์:** ตรวจสอบหน้าจัดการการแจ้งเตือนโดยเฉพาะ

1. **การนำทาง:** เปิดเมนู "Fleet" ในแถบนำทาง
2. **คลิกลิงก์:** คลิกที่ "Maintenance Alerts"
3. **ตรวจสอบหน้าเพจ:**
   - URL ควรเป็น `/maintenance/alerts`
   - หัวข้อควรเป็น "Maintenance Alerts"
   - ตารางควรแสดงคอลัมน์: Vehicle, Service, Status, Triggered และ Actions
   - สัญลักษณ์สถานะควรมีสี (สีแดงสำหรับ Overdue, สีเหลือง/ส้มสำหรับ Due Soon)

---

## กรณีทดสอบที่ 4: การสั่งรันด้วยตนเอง (สำหรับ Admin เท่านั้น)
**วัตถุประสงค์:** ตรวจสอบว่าผู้ดูแลระบบสามารถสั่งตรวจสอบการแจ้งเตือนได้ด้วยตนเองจากหน้าเว็บ

1. **เข้าสู่ระบบ:** เข้าสู่ระบบด้วยสิทธิ์ **Org Admin**
2. **ไปที่หน้า:** ไปที่ `/maintenance/alerts`
3. **ดำเนินการ:** คลิกปุ่ม "Trigger Manual Check" ในส่วนหัวของหน้า
4. **ตรวจสอบ:**
   - ควรมีข้อความแจ้งเตือน (Toast) สีเขียวปรากฏขึ้น: "Manual maintenance check triggered. {0} new alerts created."
   - รายการในตารางควรถูกรีเฟรชโดยอัตโนมัติ

---

## กรณีทดสอบที่ 5: ทำเครื่องหมายว่าอ่านแล้ว (Mark as Read)
**วัตถุประสงค์:** ตรวจสอบว่าสามารถรับทราบการแจ้งเตือนได้โดยไม่ต้องแก้ไขปัญหาทั้งหมด

1. **ดำเนินการ:** คลิกไอคอนรูป "ดวงตา" (Mark as Read) ที่รายการแจ้งเตือนใดก็ได้ในตาราง
2. **ตรวจสอบ:**
   - ควรมีข้อความแจ้งเตือนปรากฏขึ้น: "Alert marked as read."
   - รายการแจ้งเตือนนั้นควรถูกลบออกจากรายการที่ "Active" ปัจจุบัน

---

## กรณีทดสอบที่ 6: การจัดการการแจ้งเตือน (Resolve Alert)
**วัตถุประสงค์:** ตรวจสอบว่าสามารถปิดการแจ้งเตือนพร้อมระบุบันทึกได้

1. **ดำเนินการ:** คลิกไอคอนรูป "เครื่องหมายถูก" (Resolve) ที่รายการแจ้งเตือนใดก็ได้
2. **ใส่ข้อมูล:** ในกล่องโต้ตอบ ให้ระบุบันทึกการจัดการ (เช่น "เปลี่ยนน้ำมันเครื่องเรียบร้อยแล้วโดยช่าง ก")
3. **ตรวจสอบ:**
   - ควรมีข้อความแจ้งเตือนปรากฏขึ้น: "Alert resolved successfully."
   - รายการแจ้งเตือนนั้นควรถูกลบออกจากรายการ
   - (ไม่บังคับ) ตรวจสอบในฐานข้อมูลว่าเรคคอร์ดการแจ้งเตือนนั้นมีข้อมูล `ResolvedDate`, `ResolvedBy` และ `Notes` ครบถ้วน
