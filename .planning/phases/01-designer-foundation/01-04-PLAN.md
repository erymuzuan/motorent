---
phase: 01-designer-foundation
plan: 04
type: execute
wave: 2
depends_on: [01-01]
files_modified:
  - src/MotoRent.Client/Components/Designer/PropertiesPanel.razor
  - src/MotoRent.Client/Components/Designer/PropertiesPanel.razor.cs
  - src/MotoRent.Client/Components/Designer/PropertiesPanel.razor.css
autonomous: true

must_haves:
  truths:
    - "Panel shows properties for the selected element"
    - "Changes to properties immediately update the element"
    - "Different element types show different property editors"
  artifacts:
    - path: "src/MotoRent.Client/Components/Designer/PropertiesPanel.razor"
      provides: "Property editor panel"
      contains: "switch.*Element"
    - path: "src/MotoRent.Client/Components/Designer/PropertiesPanel.razor.cs"
      provides: "Panel code-behind"
      contains: "OnPropertyChanged"
  key_links:
    - from: "PropertiesPanel.razor"
      to: "TemplateElement subtypes"
      via: "Switch pattern matching"
      pattern: "TextElement|ImageElement|ContainerElement"
    - from: "PropertiesPanel.razor"
      to: "Parent component"
      via: "EventCallback"
      pattern: "EventCallback.*OnPropertyChanged"
---

<objective>
Create the properties panel component for configuring selected elements.

Purpose: Allow users to edit element properties (font size, alignment, dimensions, etc.) with immediate visual feedback.
Output: PropertiesPanel component with type-specific property editors
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-designer-foundation/01-RESEARCH.md

# Domain model from Plan 01
@src/MotoRent.Domain/Templates/TemplateElement.cs
@src/MotoRent.Domain/Templates/Elements/TextElement.cs
@src/MotoRent.Domain/Templates/Elements/ImageElement.cs

# Existing form patterns
@src/MotoRent.Client/Pages/InsuranceDialog.razor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PropertiesPanel Component</name>
  <files>
    src/MotoRent.Client/Components/Designer/PropertiesPanel.razor
    src/MotoRent.Client/Components/Designer/PropertiesPanel.razor.cs
    src/MotoRent.Client/Components/Designer/PropertiesPanel.razor.css
  </files>
  <action>
Create `PropertiesPanel.razor` with type-specific property editors.

Structure:
```razor
@inherits LocalizedComponentBase<PropertiesPanel>
@using MotoRent.Domain.Templates
@using MotoRent.Domain.Templates.Elements

<div class="properties-panel">
    @if (Element is null)
    {
        <div class="text-muted p-3">@Localizer["SelectElement"]</div>
    }
    else
    {
        <div class="panel-header">
            <h6>@GetElementTypeName()</h6>
            <button class="btn btn-ghost-danger btn-sm" @onclick="OnDeleteClick">
                <i class="ti ti-trash"></i>
            </button>
        </div>

        <div class="panel-body">
            @* Common properties *@
            <div class="mb-3">
                <label class="form-label">@Localizer["Label"]</label>
                <input type="text" class="form-control form-control-sm"
                       @bind="Element.Label" @bind:event="oninput" @bind:after="NotifyChange" />
            </div>

            @* Type-specific properties *@
            @switch (Element)
            {
                case TextElement text:
                    @RenderTextProperties(text)
                    break;
                case ImageElement image:
                    @RenderImageProperties(image)
                    break;
                case ContainerElement container:
                    @RenderContainerProperties(container)
                    break;
                case DividerElement divider:
                    @RenderDividerProperties(divider)
                    break;
                case DateElement date:
                    @RenderDateProperties(date)
                    break;
                case SignatureElement signature:
                    @RenderSignatureProperties(signature)
                    break;
            }

            @* Common layout properties *@
            <hr class="my-3" />
            <h6 class="mb-2">@Localizer["Layout"]</h6>
            @RenderLayoutProperties()
        </div>
    }
</div>
```

**TextElement properties:**
- Content (textarea)
- FontSize (number input, 8-72)
- FontWeight (select: normal/bold)
- FontStyle (select: normal/italic)
- TextAlign (select: left/center/right)
- Color (color input)

**ImageElement properties:**
- Source (text input for URL)
- AltText (text input)
- MaxWidth (number input)
- MaxHeight (number input)
- ObjectFit (select: contain/cover/fill)

**ContainerElement properties:**
- Layout (select: vertical/horizontal/two-column)
- Gap (number input)
- Padding (number input)
- Border (text input for CSS)
- Background (color input)

**DividerElement properties:**
- Style (select: solid/dashed/dotted)
- Thickness (number input, 1-10)
- Color (color input)

**DateElement properties:**
- Format (text input with examples)

**SignatureElement properties:**
- ShowLine (checkbox)
- LineWidth (number input)

**Common layout properties (all elements):**
- Width (number input or "auto")
- Height (number input or "auto")
- Alignment (select: left/center/right)
- MarginTop (number input)
- MarginBottom (number input)

Create `PropertiesPanel.razor.cs` code-behind:
```csharp
[Parameter, EditorRequired] public TemplateElement? Element { get; set; }
[Parameter] public EventCallback OnPropertyChanged { get; set; }
[Parameter] public EventCallback OnDeleteRequested { get; set; }

private async Task NotifyChange() => await OnPropertyChanged.InvokeAsync();
private async Task OnDeleteClick() => await OnDeleteRequested.InvokeAsync();
```

Use `@bind:after="NotifyChange"` pattern for immediate updates (Blazor .NET 7+ feature).

Create `PropertiesPanel.razor.css` with:
- `.properties-panel` - full height, overflow-y auto, padding
- `.panel-header` - flex between, border-bottom
- `.panel-body` - padding
- Form control sizing using Tabler's `form-control-sm`
  </action>
  <verify>
Run `dotnet build src/MotoRent.Client/` - should compile without errors.
  </verify>
  <done>
PropertiesPanel component exists with type-specific editors for all 6 element types plus common layout properties.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Localization Resources</name>
  <files>
    src/MotoRent.Client/Resources/Components/Designer/PropertiesPanel.resx
    src/MotoRent.Client/Resources/Components/Designer/PropertiesPanel.en.resx
    src/MotoRent.Client/Resources/Components/Designer/PropertiesPanel.th.resx
  </files>
  <action>
Create resource files for PropertiesPanel localization.

Create directory `src/MotoRent.Client/Resources/Components/Designer/` if not exists.

**PropertiesPanel.resx (default - English):**
```xml
<data name="SelectElement" xml:space="preserve">
  <value>Select an element to edit properties</value>
</data>
<data name="Label" xml:space="preserve">
  <value>Label</value>
</data>
<data name="Layout" xml:space="preserve">
  <value>Layout</value>
</data>
<data name="Content" xml:space="preserve">
  <value>Content</value>
</data>
<data name="FontSize" xml:space="preserve">
  <value>Font Size</value>
</data>
<data name="FontWeight" xml:space="preserve">
  <value>Font Weight</value>
</data>
<data name="FontStyle" xml:space="preserve">
  <value>Font Style</value>
</data>
<data name="TextAlign" xml:space="preserve">
  <value>Text Alignment</value>
</data>
<data name="Color" xml:space="preserve">
  <value>Color</value>
</data>
<data name="Source" xml:space="preserve">
  <value>Image URL</value>
</data>
<data name="AltText" xml:space="preserve">
  <value>Alt Text</value>
</data>
<data name="MaxWidth" xml:space="preserve">
  <value>Max Width</value>
</data>
<data name="MaxHeight" xml:space="preserve">
  <value>Max Height</value>
</data>
<data name="ObjectFit" xml:space="preserve">
  <value>Object Fit</value>
</data>
<data name="LayoutDirection" xml:space="preserve">
  <value>Direction</value>
</data>
<data name="Gap" xml:space="preserve">
  <value>Gap</value>
</data>
<data name="Padding" xml:space="preserve">
  <value>Padding</value>
</data>
<data name="Border" xml:space="preserve">
  <value>Border</value>
</data>
<data name="Background" xml:space="preserve">
  <value>Background</value>
</data>
<data name="Style" xml:space="preserve">
  <value>Style</value>
</data>
<data name="Thickness" xml:space="preserve">
  <value>Thickness</value>
</data>
<data name="Format" xml:space="preserve">
  <value>Date Format</value>
</data>
<data name="ShowLine" xml:space="preserve">
  <value>Show Signature Line</value>
</data>
<data name="LineWidth" xml:space="preserve">
  <value>Line Width</value>
</data>
<data name="Width" xml:space="preserve">
  <value>Width</value>
</data>
<data name="Height" xml:space="preserve">
  <value>Height</value>
</data>
<data name="Alignment" xml:space="preserve">
  <value>Alignment</value>
</data>
<data name="MarginTop" xml:space="preserve">
  <value>Margin Top</value>
</data>
<data name="MarginBottom" xml:space="preserve">
  <value>Margin Bottom</value>
</data>
```

**PropertiesPanel.en.resx:** Copy of default (same values)

**PropertiesPanel.th.resx:** Thai translations
```xml
<data name="SelectElement" xml:space="preserve">
  <value>เลือกองค์ประกอบเพื่อแก้ไขคุณสมบัติ</value>
</data>
<data name="Label" xml:space="preserve">
  <value>ป้ายกำกับ</value>
</data>
<data name="Layout" xml:space="preserve">
  <value>เลย์เอาท์</value>
</data>
<data name="Content" xml:space="preserve">
  <value>เนื้อหา</value>
</data>
<data name="FontSize" xml:space="preserve">
  <value>ขนาดตัวอักษร</value>
</data>
<data name="FontWeight" xml:space="preserve">
  <value>ความหนาตัวอักษร</value>
</data>
<data name="FontStyle" xml:space="preserve">
  <value>รูปแบบตัวอักษร</value>
</data>
<data name="TextAlign" xml:space="preserve">
  <value>การจัดแนวข้อความ</value>
</data>
<data name="Color" xml:space="preserve">
  <value>สี</value>
</data>
<data name="Source" xml:space="preserve">
  <value>URL รูปภาพ</value>
</data>
<data name="AltText" xml:space="preserve">
  <value>ข้อความทดแทน</value>
</data>
<data name="MaxWidth" xml:space="preserve">
  <value>ความกว้างสูงสุด</value>
</data>
<data name="MaxHeight" xml:space="preserve">
  <value>ความสูงสูงสุด</value>
</data>
<data name="ObjectFit" xml:space="preserve">
  <value>การปรับขนาด</value>
</data>
<data name="LayoutDirection" xml:space="preserve">
  <value>ทิศทาง</value>
</data>
<data name="Gap" xml:space="preserve">
  <value>ระยะห่าง</value>
</data>
<data name="Padding" xml:space="preserve">
  <value>ระยะขอบใน</value>
</data>
<data name="Border" xml:space="preserve">
  <value>เส้นขอบ</value>
</data>
<data name="Background" xml:space="preserve">
  <value>พื้นหลัง</value>
</data>
<data name="Style" xml:space="preserve">
  <value>รูปแบบ</value>
</data>
<data name="Thickness" xml:space="preserve">
  <value>ความหนา</value>
</data>
<data name="Format" xml:space="preserve">
  <value>รูปแบบวันที่</value>
</data>
<data name="ShowLine" xml:space="preserve">
  <value>แสดงเส้นลายเซ็น</value>
</data>
<data name="LineWidth" xml:space="preserve">
  <value>ความกว้างเส้น</value>
</data>
<data name="Width" xml:space="preserve">
  <value>ความกว้าง</value>
</data>
<data name="Height" xml:space="preserve">
  <value>ความสูง</value>
</data>
<data name="Alignment" xml:space="preserve">
  <value>การจัดแนว</value>
</data>
<data name="MarginTop" xml:space="preserve">
  <value>ระยะขอบบน</value>
</data>
<data name="MarginBottom" xml:space="preserve">
  <value>ระยะขอบล่าง</value>
</data>
```

Use standard resx XML structure with resheader elements.
  </action>
  <verify>
Resource files exist and are valid XML. `dotnet build src/MotoRent.Client/` compiles successfully.
  </verify>
  <done>
Localization resources exist for PropertiesPanel in English and Thai.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build src/MotoRent.Client/` compiles successfully
2. PropertiesPanel shows "Select an element" when no element selected
3. PropertiesPanel shows type-specific editors when element is selected
4. All 6 element types have appropriate property editors
5. Common layout properties shown for all elements
6. Localization resources exist for both English and Thai
</verification>

<success_criteria>
- Properties panel renders appropriate editors per element type
- Two-way binding updates element properties
- OnPropertyChanged callback fires on any property change
- Delete button triggers OnDeleteRequested
- Localization working for all labels
</success_criteria>

<output>
After completion, create `.planning/phases/01-designer-foundation/01-04-SUMMARY.md`
</output>
