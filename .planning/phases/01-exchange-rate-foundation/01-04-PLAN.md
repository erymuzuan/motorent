---
phase: 01-exchange-rate-foundation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/MotoRent.Client/Pages/Staff/Till.razor
  - src/MotoRent.Client/Layout/NavMenu.razor
  - src/MotoRent.Client/Resources/Layout/NavMenu.resx
  - src/MotoRent.Client/Resources/Layout/NavMenu.th.resx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Staff can see exchange rates floating button when till session is active"
    - "Manager can navigate to exchange rate settings from Settings menu"
  artifacts:
    - path: "src/MotoRent.Client/Pages/Staff/Till.razor"
      provides: "ExchangeRatePanel integration"
      contains: "ExchangeRatePanel"
    - path: "src/MotoRent.Client/Layout/NavMenu.razor"
      provides: "Exchange rates navigation link"
      contains: "/settings/exchange-rates"
  key_links:
    - from: "src/MotoRent.Client/Pages/Staff/Till.razor"
      to: "src/MotoRent.Client/Components/Till/ExchangeRatePanel.razor"
      via: "component reference"
      pattern: "<ExchangeRatePanel"
    - from: "src/MotoRent.Client/Layout/NavMenu.razor"
      to: "/settings/exchange-rates"
      via: "navigation link"
      pattern: 'href="/settings/exchange-rates"'
---

<objective>
Wire existing ExchangeRatePanel component to Till page and add navigation link to exchange rate settings.

Purpose: Close integration gaps from Phase 1 verification - components exist but are not connected to the UI.
Output: Staff see exchange rates FAB on Till page; Managers have nav link to exchange rate settings.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-exchange-rate-foundation/01-VERIFICATION.md

# Existing components to wire
@src/MotoRent.Client/Components/Till/ExchangeRatePanel.razor
@src/MotoRent.Client/Pages/Staff/Till.razor
@src/MotoRent.Client/Layout/NavMenu.razor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire ExchangeRatePanel to Till.razor</name>
  <files>src/MotoRent.Client/Pages/Staff/Till.razor</files>
  <action>
Add the ExchangeRatePanel component to the Till.razor page. The panel should only appear when a till session is active (when `m_session` is not null).

1. Add `@using MotoRent.Client.Components.Till` at the top with other using statements

2. Inside the active session section (after the closing `</div>` of container-xl at line ~373, but before the closing `}`), add the ExchangeRatePanel:
```razor
@* ========== EXCHANGE RATE FAB ========== *@
<ExchangeRatePanel />
```

The component already has the FAB button built-in (ShowButton defaults to true) so no additional configuration is needed. The FAB will appear in the bottom-right corner and staff can click it to see rates and use the calculator.

DO NOT modify any other part of Till.razor - this is purely adding the component reference.
  </action>
  <verify>
1. Build the project: `dotnet build`
2. No compilation errors related to ExchangeRatePanel
3. Visually confirm: Navigate to /staff/till, open a session, verify FAB appears in bottom-right corner
  </verify>
  <done>ExchangeRatePanel FAB visible on Till page when session is active; clicking FAB opens rate panel with calculator</done>
</task>

<task type="auto">
  <name>Task 2: Add Exchange Rates nav link to Settings menu</name>
  <files>
    src/MotoRent.Client/Layout/NavMenu.razor
    src/MotoRent.Client/Resources/Layout/NavMenu.resx
    src/MotoRent.Client/Resources/Layout/NavMenu.th.resx
  </files>
  <action>
Add a navigation link to the exchange rate settings page in the Settings dropdown menu.

1. In NavMenu.razor, find the Settings dropdown (line ~124). Add a new link after the "Agents" link and before the divider (around line 143). Insert:
```razor
<a class="dropdown-item" href="/settings/exchange-rates">
    <i class="ti ti-arrows-exchange me-2"></i>@Localizer["ExchangeRates"]
</a>
```

2. In NavMenu.resx (default/English), add after the "Agents" entry:
```xml
<data name="ExchangeRates" xml:space="preserve">
    <value>Exchange Rates</value>
</data>
```

3. In NavMenu.th.resx (Thai), add:
```xml
<data name="ExchangeRates" xml:space="preserve">
    <value>อัตราแลกเปลี่ยน</value>
</data>
```

Note: NavMenu.ms.resx does not exist in this project (only en and th are used).

The link should be visible to ManagementRoles (OrgAdmin, ShopManager) as it's within the Settings AuthorizeView block.
  </action>
  <verify>
1. Build the project: `dotnet build`
2. Verify NavMenu.razor compiles without errors
3. Visually confirm: Login as manager, see "Exchange Rates" in Settings dropdown
4. Click link navigates to /settings/exchange-rates
  </verify>
  <done>Exchange Rates link appears in Settings dropdown for managers; clicking navigates to /settings/exchange-rates page</done>
</task>

</tasks>

<verification>
After completing both tasks:

1. **Staff workflow test:**
   - Login as Staff role
   - Navigate to /staff/till
   - Open a till session
   - Verify exchange rate FAB appears (bottom-right, currency icon)
   - Click FAB, verify panel opens with rates and calculator
   - Close panel, verify FAB returns to normal state

2. **Manager workflow test:**
   - Login as OrgAdmin or ShopManager role
   - Open Settings dropdown in navbar
   - Verify "Exchange Rates" link is visible
   - Click link, verify navigation to /settings/exchange-rates
   - Page should load with rate management UI

3. **Build verification:**
   - `dotnet build` succeeds with no warnings related to NavMenu or Till
</verification>

<success_criteria>
1. ExchangeRatePanel FAB visible on Till page when session is active
2. Exchange Rates link present in Settings dropdown
3. Both links navigate to correct pages
4. Localization works (English and Thai)
5. Project builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-exchange-rate-foundation/01-04-SUMMARY.md`
</output>
